<ng-progress [showSpinner]="false" [color]="'blue'"></ng-progress>

<div class='loading' [hidden]="!loadingTickets">
	<div class='container'>
		<div class='loader'>
			<div class='loader--dot'></div>
			<div class='loader--dot'></div>
			<div class='loader--dot'></div>
			<div class='loader--dot'></div>
			<div class='loader--dot'></div>
			<div class='loader--dot'></div>
			<div class='loader--text'></div>
		</div>
	</div>
</div>

<div class="container-fluid top-space" [hidden]='loadingTickets'>
	<div class="row">
		<div class="col-12">
			<h1 class='text-center title-spacing'>{{jira.title}} Tickets</h1>
		</div>
	</div>
	<div class="row">
		<div class="col-12">
			<div [hidden]='!openTickets'>
				<table class='table-striped' datatable [dtOptions]="dtOptions" [dtTrigger]="dtTrigger">
					<thead>
						<tr>
							<th>Key</th>
							<th>MSRP</th>
							<th>Summary</th>
							<th>Status</th>
							<th>Start Date</th>
							<th>Due Date</th>
							<th>Estimate</th>
							<th>Logged</th>
							<th>Last Update</th>
							<th>Created</th>
							<th>Crucible</th>
							<th>ATTuid</th>
							<th>Customer Attuid</th>
						</tr>
					</thead>

					<tbody>
						<tr *ngFor='let ticket of openTickets' id='{{ticket.key}}'>
							<td><a target="_blank" href="{{config.jiraUrl}}/browse/{{ticket.key}}">{{ticket.key}}</a></td>
							<td>{{ticket.msrp}}</td>
							<td class='summary-format'>{{ticket.summary}}</td>
							<td>
								<div class='float-left'>
									{{ticket.status}}
									<div>{{ticket.component}}</div>
								</div>
								<i 
									*ngIf='jira.title == "My Open" || jira.title == "All Open"'
									class="material-icons float-right" 
									title='Generate QA/Crucible'
									(click)="openQAModal(ticket.msrp, ticket.key)"
								>
									assignment
								</i>
								
							</td>
							<td>{{ticket.dates.started | amDateFormat:'LL'}}</td>
							<td>{{ticket.dates.duedate | amDateFormat:'LL'}}</td>
							<td>{{ticket.dates.estimate | worktime }}</td>
							<td>{{ticket.dates.logged | worktime}}</td>
							<td>{{ticket.dates.updated | amDateFormat:'LL'}}</td>
							<td>{{ticket.dates.created | amDateFormat:'LL'}}</td>
							<td>
								<div *ngIf='ticket.crucible_id'>
									<a 
										target="_blank" 
										class='float-left'
										href="{{config.crucibleUrl}}/cru/{{ticket.crucible_id}}">
											{{ticket.crucible_id}}
									</a>
									<i 
										class="material-icons float-right" 
										title='PCR Pass/Complete' 
										(click)="openPCRModal(ticket.crucible_id, ticket.key, 'pass', statusModal)"
									>
										done
									</i>
								</div>
							</td>
							<td>
								<a [href]="jira.chatUrlSanitize(ticket.username)" title="Open Q chat window with {{ticket.username}}">{{ticket.username}}</a>
								<img src="http://presence.q.att.com/presence/{{ticket.username}}.gif">
							</td>
							<td>
								<a [href]="jira.chatUrlSanitize(ticket.customer_details.username)" title="Open Q chat window with {{ticket.customer_details.display_name}}">
									{{ticket.customer_details.username}}
								</a>
								<img src="http://presence.q.att.com/presence/{{ticket.customer_details.username}}.gif">
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>





<!-- PCR Model -->
<ng-template #statusModal let-c="close" let-d="dismiss">
	<div class="modal-header">
		<h4 class="modal-title">PCR Pass/Complete</h4>
		<button type="button" class="close" aria-label="Close" (click)="c()">
			<span aria-hidden="true">&times;</span>
		</button>
	</div>
	<div class="modal-body">
		<p>Would you like to PCR Pass or Complete?</p>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn btn-outline-success" (click)="c('pass')">PCR Pass</button>
		<button type="button" class="btn btn-outline-primary" (click)="c('complete')">PCR Complete</button>
		<button type="button" class="btn btn-outline-danger" (click)="c()">Cancel</button>
	</div>
</ng-template>


<app-qa-generator (newCrucible)="newCrucible($event)"></app-qa-generator>